import{_ as S,m as f,A as V,a as L,r as _,o as i,b as n,d as t,l as T,f as g,g as m,n as v,F as w,e as P,w as I,v as q,t as l,p as $,k as E,L as R,h as b,j as U,q as A,s as N}from"./index-3d2615e5.js";import{c as x}from"./cart-76e743fc.js";import{P as B}from"./PaginationView-323d2d0a.js";import{T as D}from"./toast-027f9946.js";const j="/headphone/assets/products-banner-e1295836.jpg";const{VITE_URL:p,VITE_PATH:h}={VITE_URL:"https://vue3-course-api.hexschool.io/v2",VITE_PATH:"test8283",BASE_URL:"/headphone/",MODE:"production",DEV:!1,PROD:!0,SSR:!1},M={inject:["currency"],data(){return{bannerImg:j,products:[],filteredProducts:[],selectedCategory:this.$route.query.category,categories:[],selectedSort:"價格高到低",minPrice:null,maxPrice:null,pagination:{}}},methods:{...f(R,["showLoading","hideLoading"]),async getProducts(){try{const e=await this.$http.get(`${p}/api/${h}/products/all`);this.products=e.data.products,await this.getCategories()}catch(e){alert(e.response.data.message)}},async filterProducts(e=1){let o=`${p}/api/${h}/products?page=${e}`;const a=this.$route.query.category;a&&a!=="全部"&&(o=`${p}/api/${h}/products?page=${e}&category=${a}`);try{const c=await this.$http.get(o);this.filteredProducts=c.data.products,this.pagination=c.data.pagination,this.$router.push({path:"products",query:{category:a,page:e}}),this.hideLoading()}catch(c){alert(c.response.data.message)}},getCategories(){const e=[...new Set(this.products.map(o=>o.category))];this.categories=e},async addToCart(e,o=1){const a={product_id:e,qty:o};try{const c=await this.$http.post(`${p}/api/${h}/cart`,{data:a});this.getCart(),D.fire({icon:"success",title:c.data.message,width:250})}catch(c){alert(c.response.data.message)}},sortProducts(){let e=this.$route.query.category==="全部"?this.products:this.products.filter(o=>o.category===this.$route.query.category);this.selectedSort==="價格高到低"?this.filteredProducts=e.sort((o,a)=>a.price-o.price):this.selectedSort==="價格低到高"?this.filteredProducts=e.sort((o,a)=>o.price-a.price):this.filteredProducts=e},...f(x,["getCart"])},components:{PaginationView:B},async mounted(){try{await this.getProducts(),await this.filterProducts()}catch(e){alert(e.response.data.message)}V.init({duration:1e3,once:!0})},computed:{...L(x,["carts"])},created(){this.showLoading()},watch:{$route:{handler(e){this.showLoading(),e.name==="products"&&this.filterProducts(this.$route.query.page),this.selectedCategory=e.query.category},deep:!0}}},u=e=>(A("data-v-5c878a14"),e=e(),N(),e),O={class:"container py-8"},z={class:"row gx-4 gy-3"},F={class:"col-lg-3 col-12"},H={class:"p-2 border border-2 rounded-3 position-sticky product-menu",style:{top:"12%"}},G=u(()=>t("div",{class:"product-title"},[t("h4",null,"商品類型")],-1)),J={class:"px-3 w-md-auto w-100"},K={class:"mb-1"},Q={class:"col-lg-9 col-12"},W={class:"row gy-2 align-items-center pt-2 pb-3 px-md-0 px-3"},X={class:"col-md-4 col-12"},Y=u(()=>t("option",{value:"照順序排列"},"照順序排列",-1)),Z=u(()=>t("option",{value:"價格低到高"},"價格低到高",-1)),tt=u(()=>t("option",{value:"價格高到低"},"價格高到低",-1)),et=[Y,Z,tt],st={class:"col-md-8 col-12"},ot=u(()=>t("hr",null,null,-1)),rt={key:0},at={class:"row gy-4 py-2"},ct={style:{position:"relative",background:"#f1f1f1"}},it=["src","alt"],nt=["onClick"],dt={class:"card-body d-flex flex-column"},lt={class:"mb-2 text-title"},ut={class:"text-text mb-2 fs-6"},pt={class:"d-flex align-items-center gap-3 mt-auto mb-2"},ht={class:"text-title text-muted fs-6"},_t={class:"text-title fs-6"},gt={key:1},mt=u(()=>t("div",{class:"text-center mt-4"},[t("h3",null,"找不到產品")],-1)),yt=[mt];function ft(e,o,a,c,r,d){const y=_("router-link"),k=_("RouterLink"),C=_("PaginationView");return i(),n("main",null,[t("div",{class:"banner-img d-flex justify-content-center align-items-center",style:T([{height:"500px"},{backgroundImage:`url(${r.bannerImg})`}])},null,4),t("div",O,[t("div",z,[t("div",F,[t("div",H,[t("div",null,[G,t("ul",J,[t("li",K,[g(y,{to:{query:{category:"全部",page:1}},class:v({selected:r.selectedCategory==="全部"})},{default:m(()=>[b(" 全部 ")]),_:1},8,["class"])]),(i(!0),n(w,null,P(r.categories,s=>(i(),n("li",{class:"mb-1",key:s},[g(y,{to:{query:{category:s,page:1}},class:v({selected:r.selectedCategory===s})},{default:m(()=>[b(l(s),1)]),_:2},1032,["to","class"])]))),128))])])])]),t("div",Q,[t("div",W,[t("div",X,[I(t("select",{class:"w-100 p-2 border border-dark rounded-3","onUpdate:modelValue":o[0]||(o[0]=s=>r.selectedSort=s),onChange:o[1]||(o[1]=(...s)=>d.sortProducts&&d.sortProducts(...s))},et,544),[[q,r.selectedSort]])]),t("div",st,[t("h4",null,l(r.selectedCategory==="全部"?"":r.selectedCategory),1)])]),ot,r.filteredProducts[r.filteredProducts.length-1]?(i(),n("div",rt,[t("div",at,[(i(!0),n(w,null,P(r.filteredProducts,s=>(i(),n("div",{class:"col-lg-4 col-md-6 col-12",key:s.id,"data-aos":"fade-up"},[g(k,{to:`/product/${s.id}`,class:"card overflow-hidden"},{default:m(()=>[t("div",ct,[t("img",{src:s.imageUrl,class:"card-img-top card-img",alt:s.title},null,8,it),t("button",{type:"button",onClick:U(()=>d.addToCart(s.id),["prevent"]),class:"btn btn-primary text-white position-absolute bottom-0 end-0 card-button"}," 加入購物車 ",8,nt)]),t("div",dt,[t("h4",lt,l(s.title),1),t("h4",ut,l(s.description1),1),t("div",pt,[t("del",ht,"NT$ "+l(d.currency(s.origin_price)),1),t("p",_t," NT$ "+l(d.currency(s.price)),1)])])]),_:2},1032,["to"])]))),128))]),r.pagination.total_pages!==1?(i(),$(C,{key:0,pages:r.pagination,onUpdatePage:d.filterProducts},null,8,["pages","onUpdatePage"])):E("",!0)])):(i(),n("div",gt,yt))])])])])}const xt=S(M,[["render",ft],["__scopeId","data-v-5c878a14"]]);export{xt as default};
